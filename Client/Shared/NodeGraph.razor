@using VirtualStudio.ViewModels;

<div class="viewport nodegraph" onwheel="panzoom.zoom(event)"
     @onmousedown="StartPan" @onmousedown:preventDefault
     ondragover="event.preventDefault()" @ondrop="@OnDrop" @onkeydown="@OnKeyDown" tabindex="-1">
    <div style="width:100%; height:100%; position:absolute;" @onclick="@OnClick"></div>
    <div id="nodegraph" style="position:relative; transform-origin:0% 0%; width:0px; height:0px;">
        @foreach(var node in ViewModel.ComponentNodes)
        {
            <NodeView @key="node" ViewModel="node"/>
        }
    </div>
</div>

@code {
    [Parameter] public VirtualStudioViewModel ViewModel { get; set; }

    async Task StartPan(MouseEventArgs e)
    {
        // clickStartPos = e.GetClientPos();
        // await JSRuntime.InvokeVoidAsync("panzoom.startPan");
    }

    void OnDrop(DragEventArgs e)
    {
        // NodeDragService.OnDrop(e);
        // Refresh();
    }

    void OnKeyDown(KeyboardEventArgs e)
    {
        //if (e.Key == "Delete" || e.Key == "Backspace")
        //{
        //    NodeHandler.DeleteSelectedNode();
        //}
        //else if (e.Key == "Escape")
        //{
        //    DeselectNode();
        //}
    }

    void OnClick(MouseEventArgs e)
    {
        //const int dragThreshold = 4; //Length in px to consider a drag (instead of a click)
        //var mouseOffset = e.GetClientPos() - clickStartPos;

        //if (mouseOffset.GetLength() <= dragThreshold)
        //{
        //    DeselectNode();
        //}
    }
}
